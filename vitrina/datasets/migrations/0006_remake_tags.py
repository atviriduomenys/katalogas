# Generated by Django 3.2.15 on 2022-09-29 10:59
import re

from django.db import migrations


def remake_tags(apps, schema_editor):
    Dataset = apps.get_model("vitrina_datasets", "Dataset")
    datasets_with_tags = Dataset.objects.filter(tags_old__isnull=False)
    for dataset in datasets_with_tags:
        old_tags = re.split(';|,', dataset.tags_old)
        for tag in old_tags:
            tag.strip().strip('"').strip("'").strip('.').lower()
            if len(str(tag)) > 0:
                dataset.tags.add(tag)


class Migration(migrations.Migration):

    dependencies = [
        ('vitrina_datasets', '0005_create_new_tags'),
    ]

    operations = [
        migrations.RunPython(remake_tags),
    ]
